<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè®© javascript å¯ä»¥ä»æ‚ä¹±å›è°ƒå‡½æ•°ä¸­è§£è„±å‡ºæ¥ã€‚åæ¥ ES6 æ ‡å‡†æŠŠ Promise çº³å…¥å…¶ä¸­ï¼ŒåŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚Promise ä¹Ÿæˆä¸º ES6 æœ€ä¸»è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚ç½‘ä¸Šä»‹ç» promise ä½¿ç”¨æ–¹æ³•çš„æ–‡ç« å¾ˆå¤šï¼Œè§£é‡Šå…¶åŸç†å´å¾ˆå°‘ã€‚è¿™ç¯‡æ–‡ç« å¾ªåºæ¸è¿›åœ°å®ç°äº†ä¸€é promiseï¼Œåˆ†æé€å½»ï¼Œå¯¹äº†è§£ promise çš„å·¥ä½œåŸç†å¾ˆæœ‰å¸®åŠ©ã€‚ä¸ºäº†">
<meta property="og:type" content="article">
<meta property="og:title" content="ç¿»è¯‘ï¼šJavaScript Promises å®ç°åŸç†è¯¦è§£ï¼ˆJavaScript Promises ... In Wicked Detailï¼‰">
<meta property="og:url" content="https://chasecs.github.io/2019/04/12/2017-10-07-simplified-chinese-translation-of-javascript-promises-in-wicked-detail/index.html">
<meta property="og:site_name" content="ç¼–ç¨‹æ—¥å¿—">
<meta property="og:description" content="Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè®© javascript å¯ä»¥ä»æ‚ä¹±å›è°ƒå‡½æ•°ä¸­è§£è„±å‡ºæ¥ã€‚åæ¥ ES6 æ ‡å‡†æŠŠ Promise çº³å…¥å…¶ä¸­ï¼ŒåŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚Promise ä¹Ÿæˆä¸º ES6 æœ€ä¸»è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚ç½‘ä¸Šä»‹ç» promise ä½¿ç”¨æ–¹æ³•çš„æ–‡ç« å¾ˆå¤šï¼Œè§£é‡Šå…¶åŸç†å´å¾ˆå°‘ã€‚è¿™ç¯‡æ–‡ç« å¾ªåºæ¸è¿›åœ°å®ç°äº†ä¸€é promiseï¼Œåˆ†æé€å½»ï¼Œå¯¹äº†è§£ promise çš„å·¥ä½œåŸç†å¾ˆæœ‰å¸®åŠ©ã€‚ä¸ºäº†">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-04-11T16:42:11.714Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ç¿»è¯‘ï¼šJavaScript Promises å®ç°åŸç†è¯¦è§£ï¼ˆJavaScript Promises ... In Wicked Detailï¼‰">
<meta name="twitter:description" content="Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè®© javascript å¯ä»¥ä»æ‚ä¹±å›è°ƒå‡½æ•°ä¸­è§£è„±å‡ºæ¥ã€‚åæ¥ ES6 æ ‡å‡†æŠŠ Promise çº³å…¥å…¶ä¸­ï¼ŒåŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚Promise ä¹Ÿæˆä¸º ES6 æœ€ä¸»è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚ç½‘ä¸Šä»‹ç» promise ä½¿ç”¨æ–¹æ³•çš„æ–‡ç« å¾ˆå¤šï¼Œè§£é‡Šå…¶åŸç†å´å¾ˆå°‘ã€‚è¿™ç¯‡æ–‡ç« å¾ªåºæ¸è¿›åœ°å®ç°äº†ä¸€é promiseï¼Œåˆ†æé€å½»ï¼Œå¯¹äº†è§£ promise çš„å·¥ä½œåŸç†å¾ˆæœ‰å¸®åŠ©ã€‚ä¸ºäº†">





  
  
  <link rel="canonical" href="https://chasecs.github.io/2019/04/12/2017-10-07-simplified-chinese-translation-of-javascript-promises-in-wicked-detail/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ç¿»è¯‘ï¼šJavaScript Promises å®ç°åŸç†è¯¦è§£ï¼ˆJavaScript Promises ... In Wicked Detailï¼‰ | ç¼–ç¨‹æ—¥å¿—</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ç¼–ç¨‹æ—¥å¿—</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chasecs.github.io/2019/04/12/2017-10-07-simplified-chinese-translation-of-javascript-promises-in-wicked-detail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ttimehc">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ç¼–ç¨‹æ—¥å¿—">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ç¿»è¯‘ï¼šJavaScript Promises å®ç°åŸç†è¯¦è§£ï¼ˆJavaScript Promises ... In Wicked Detailï¼‰

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-04-12 00:42:11" itemprop="dateCreated datePublished" datetime="2019-04-12T00:42:11+08:00">2019-04-12</time>
            

            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">è¯„è®ºæ•°ï¼š</span>
                <a href="/2019/04/12/2017-10-07-simplified-chinese-translation-of-javascript-promises-in-wicked-detail/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2019/04/12/2017-10-07-simplified-chinese-translation-of-javascript-promises-in-wicked-detail/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          
            <div class="post-description"> Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè®© javascript å¯ä»¥ä»æ‚ä¹±å›è°ƒå‡½æ•°ä¸­è§£è„±å‡ºæ¥ã€‚åæ¥ ES6 æ ‡å‡†æŠŠ Promise çº³å…¥å…¶ä¸­ï¼ŒåŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚Promise ä¹Ÿæˆä¸º ES6 æœ€ä¸»è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚ç½‘ä¸Šä»‹ç» promise ä½¿ç”¨æ–¹æ³•çš„æ–‡ç« å¾ˆå¤šï¼Œè§£é‡Šå…¶åŸç†å´å¾ˆå°‘ã€‚è¿™ç¯‡æ–‡ç« å¾ªåºæ¸è¿›åœ°å®ç°äº†ä¸€é promiseï¼Œåˆ†æé€å½»ï¼Œå¯¹äº†è§£ promise çš„å·¥ä½œåŸç†å¾ˆæœ‰å¸®åŠ©ã€‚ä¸ºäº†åŠ æ·±å°è±¡ï¼Œæ‰€ä»¥æŠŠåŸæ–‡ç¿»è¯‘äº†ä¸€éã€‚</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
</blockquote>
<p><strong>è¯‘æŒ‰ï¼š</strong><br><em>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè®© javascript å¯ä»¥ä»æ‚ä¹±å›è°ƒå‡½æ•°ä¸­è§£è„±å‡ºæ¥ã€‚åæ¥ ES6 æ ‡å‡†æŠŠ Promise çº³å…¥å…¶ä¸­ï¼ŒåŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚Promise ä¹Ÿæˆä¸º ES6 æœ€ä¸»è¦çš„ç‰¹æ€§ä¹‹ä¸€ã€‚</em><br><em>ç½‘ä¸Šä»‹ç» promise ä½¿ç”¨æ–¹æ³•çš„æ–‡ç« å¾ˆå¤šï¼Œè§£é‡Šå…¶åŸç†å´å¾ˆå°‘ã€‚è¿™ç¯‡æ–‡ç« å¾ªåºæ¸è¿›åœ°å®ç°äº†ä¸€é promiseï¼Œåˆ†æé€å½»ï¼Œå¯¹äº†è§£ promise çš„å·¥ä½œåŸç†å¾ˆæœ‰å¸®åŠ©ã€‚ä¸ºäº†åŠ æ·±å°è±¡ï¼Œæ‰€ä»¥æŠŠåŸæ–‡ç¿»è¯‘äº†ä¸€éã€‚</em></p>
<blockquote>
</blockquote>
<p><strong>åŸæ–‡ï¼š</strong> <a href="http://www.mattgreer.org/articles/promises-in-wicked-detail/" target="_blank" rel="noopener">JavaScript Promises â€¦ In Wicked Detail</a></p>
<blockquote>
</blockquote>
<p>æˆ‘åœ¨è‡ªå·±çš„ JavaScript ä»£ç é‡Œä½¿ç”¨ promises æœ‰ä¸€æ®µæ—¶é—´äº†ã€‚åˆšå¼€å§‹ä½¿ç”¨çš„æ—¶å€™ç¡®å®æœ‰äº›è´¹è§£ï¼Œä½†ç°åœ¨å·²ç»é©¾è½»å°±ç†Ÿã€‚ä¸è¿‡ä»”ç»†æƒ³èµ·æ¥ï¼Œæˆ‘å¹¶ä¸æ˜¯å®Œå…¨æ˜ç™½å®ƒçš„åŸç†ã€‚å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„å°±æ˜¯ä¸ºäº†å¼„æ˜ç™½å®ƒã€‚å¦‚æœä½ åšæŒçœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ ä¹Ÿèƒ½å¾ˆå¥½åœ°ç†è§£ promiseã€‚</p>
<p>æˆ‘ä»¬å°†æ¸è¿›å¼åœ°å®ç°ä¸€ä¸ª promiseï¼Œæœ€ç»ˆç‰ˆæœ¬ä¼šåŸºæœ¬ç¬¦åˆ <a href="http://promises-aplus.github.io/promises-spec/" target="_blank" rel="noopener">Promises/A+ è§„èŒƒ</a>ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ ä¹Ÿä¼šæ˜ç™½ promise æ˜¯æ€æ ·å»æ»¡è¶³å¼‚æ­¥ç¼–ç¨‹çš„éœ€æ±‚ã€‚æœ¬æ–‡å‡å®šä½ å·²ç»å¯¹ promises æœ‰ä¸€å®šçš„äº†è§£ã€‚å¦‚æœä½ è¿˜ä»€ä¹ˆéƒ½ä¸çŸ¥é“ï¼Œå¯ä»¥å…ˆå» <a href="http://promisejs.org/" target="_blank" rel="noopener">promisejs.org</a> çœ‹çœ‹ã€‚</p>
<h2 id="æ›´æ–°æ—¥å¿—"><a href="#æ›´æ–°æ—¥å¿—" class="headerlink" title="æ›´æ–°æ—¥å¿—"></a>æ›´æ–°æ—¥å¿—</h2><ul>
<li>2017-10-07 Added a fiddle to the <a href="#å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½">This Code is Brittle and Bad</a> section to demonstrate how it can fail.</li>
<li>2014-12-23: Added <a href="#ä»Rejectä¸­æŒ½æ•‘å›æ¥">Recovering from Rejection</a> section. The article was a bit ambiguous on handling rejection, this new section should clear things up.</li>
</ul>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ol>
<li><a href="#ä¸ºä»€ä¹ˆ">ä¸ºä»€ä¹ˆ</a></li>
<li><a href="#æœ€ç®€å•çš„ä¾‹å­">æœ€ç®€å•çš„ä¾‹å­</a><ul>
<li><a href="#å®šä¹‰Promiseç±»å‹">å®šä¹‰ Promise ç±»å‹</a></li>
<li><a href="#å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½">å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½</a></li>
</ul>
</li>
<li><a href="#Promisesçš„çŠ¶æ€">Promises çš„çŠ¶æ€</a></li>
<li><a href="#å®ç°Promisesé“¾">å®ç° Promises é“¾</a><ul>
<li><a href="#å›è°ƒæ˜¯å¯é€‰é¡¹">å›è°ƒæ˜¯å¯é€‰é¡¹</a></li>
<li><a href="#åœ¨Promiseé“¾ä¸­è¿”å›Promise">åœ¨ Promise é“¾ä¸­è¿”å› Promise</a></li>
</ul>
</li>
<li><a href="#Promisesçš„Reject">Promise çš„ Reject</a><ul>
<li><a href="#æœªçŸ¥é”™è¯¯ä¹Ÿåº”è¯¥å½’çº³åˆ°Reject">æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ° Reject</a></li>
<li><a href="#Promiseså¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯">Promises å¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯</a></li>
<li><a href="#ä½¿ç”¨doneæ¥æŒ½æ•‘">ä½¿ç”¨ <code>done()</code> æ¥æŒ½æ•‘</a></li>
<li><a href="#ä»Rejectä¸­æŒ½æ•‘å›æ¥">ä» Reject ä¸­æŒ½æ•‘å›æ¥</a></li>
</ul>
</li>
<li><a href="#Promiseå¿…é¡»æ˜¯å¼‚æ­¥çš„">Promise å¿…é¡»æ˜¯å¼‚æ­¥çš„</a><ul>
<li><a href="#ä¸ºä»€ä¹ˆPromises/A+è§„èŒƒè¦æ±‚å¼‚æ­¥">ä¸ºä»€ä¹ˆ Promises/A+ è§„èŒƒè¦æ±‚å¼‚æ­¥</a></li>
</ul>
</li>
<li><a href="#å‡†å¤‡å°è£…then/promiseä¹‹å‰">å‡†å¤‡å°è£… then/promise ä¹‹å‰</a></li>
<li><a href="#ç»“è®º">ç»“è®º</a></li>
<li><a href="#å»¶ä¼¸é˜…è¯»">å»¶ä¼¸é˜…è¯»</a></li>
<li><a href="#ç¿»è¯‘">ç¿»è¯‘</a></li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><p>ä¸ºä»€ä¹ˆè¦è´¹å¿ƒæ€å»æ·±å…¥ç†è§£ promise å‘¢ï¼Ÿå¼„æ¸…æ¥šå®ƒçš„å·¥ä½œæœºåˆ¶ï¼Œä½ å¯ä»¥æ›´å¥½åœ°è¿ç”¨å®ƒï¼Œå¹¶åœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™æ›´å¥½åœ°æ’æŸ¥æ•…éšœã€‚æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„ç¼˜ç”±ï¼Œæ˜¯æœ‰ä¸€å›å’ŒåŒäº‹è¢«ä¸€ä¸ªæ£˜æ‰‹çš„ promise é—®é¢˜ç»™éš¾ä½äº†ï¼Œå¦‚æœæˆ‘å½“æ—¶åƒç°åœ¨è¿™ä¹ˆç†Ÿæ‚‰ promiseï¼Œå°±ä¸ä¼šä¸€ç­¹è«å±•ã€‚</p>
<h2 id="æœ€ç®€å•çš„ä¾‹å­"><a href="#æœ€ç®€å•çš„ä¾‹å­" class="headerlink" title="æœ€ç®€å•çš„ä¾‹å­"></a>æœ€ç®€å•çš„ä¾‹å­</h2><p>æˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªæœ€ç®€å•çš„ promise ã€‚</p>
<p>æˆ‘ä»¬è¦æŠŠè¿™æ®µä»£ç ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">doSomething(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Got a value:'</span> + value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>æ”¹é€ æˆè¿™æ ·:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Got a value:'</span> + value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä¸ºæ­¤ï¼Œéœ€è¦æŠŠ <code>doSomething()</code> ä»ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = <span class="number">42</span>;</span><br><span class="line">  callback(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ”¹æˆå¦‚ä¸‹åŸºäº â€œpromiseâ€ çš„æ–¹æ¡ˆï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    then: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> value = <span class="number">42</span>;</span><br><span class="line">      callback(value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://jsfiddle.net/city41/zdgrC/1/" target="_blank" rel="noopener">fiddle</a></p>
<p>å½“å‰çš„åšæ³•ä»…ä»…æ˜¯ç»™å›è°ƒæ¨¡å¼ï¼ˆcallback patternï¼‰çš„åŠ äº†ä¸€å±‚ç³–è¡£ï¼Œè¿˜æ²¡æœ‰ä»€ä¹ˆå®é™…ä½œç”¨ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬æ‰åˆšèµ·æ­¥ï¼Œè€Œä¸”ä¹Ÿè§¦åŠåˆ°äº† promise çš„æ ¸å¿ƒæ€æƒ³ã€‚</p>
<blockquote>
<p>Promises æ•è·ä¸€ä¸ªæ¦‚å¿µä¸Šç§°ä½œç»ˆå€¼(eventual value)çš„ä¸œè¥¿ï¼Œå¹¶æŠŠå®ƒä¿å­˜åˆ°ä¸€ä¸ªå¯¹è±¡(object)</p>
</blockquote>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆ promises å€¼å¾—ç©å‘³çš„åŸå› ã€‚å¦‚æœâ€œæœ€ç»ˆçš„ä¸œè¥¿â€å¯ä»¥è¢«æ•è·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç€æ‰‹å®ç°å¾ˆå¼ºå¤§çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å°†åœ¨ç¨åçš„æ–‡ç« ä¸­æ¢è®¨æ­¤äº‹ã€‚</p>
<h3 id="å®šä¹‰-Promise-ç±»å‹"><a href="#å®šä¹‰-Promise-ç±»å‹" class="headerlink" title="å®šä¹‰ Promise ç±»å‹"></a><a name="å®šä¹‰Promiseç±»å‹">å®šä¹‰ Promise ç±»å‹</a></h3><p>ä¸Šè¿°ä»£ç åªæ˜¯è¿”å›äº†ä¸€ä¸ªç®€å•çš„å¯¹è±¡ã€‚è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªçœŸæ­£çš„ Promise ç±»å‹ï¼Œå¹¶ä»¥å®ƒä¸ºåŸºç¡€æ¸è¿›æ‰©å±•ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> callback = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    callback = cb;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    callback(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fn(resolve);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨è¿™ä¸ª Promise ç±»å‹æ¥å®ç° <code>doSomething()</code>ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">42</span>;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“å‰çš„ä»£ç å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœä½ è¿½æº¯æ•´ä¸ªæ‰§è¡Œçš„è¿‡ç¨‹ï¼Œä½ ä¼šå‘ç° <code>resolve()</code> ä¼šåœ¨ <code>then()</code> ä¹‹å‰è¢«è°ƒç”¨ï¼Œè¿™æ„å‘³ç€æ­¤æ—¶çš„ <code>callback</code> è¿˜æ˜¯ null ã€‚æˆ‘ä»¬æš‚æ—¶å…ˆç”¨ <code>setTimeout</code> æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> callback = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">    callback = cb;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// force callback to be called in the next</span></span><br><span class="line">    <span class="comment">// iteration of the event loop, giving</span></span><br><span class="line">    <span class="comment">// callback a chance to be set by then()</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      callback(value);</span><br><span class="line">    &#125;, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fn(resolve);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://jsfiddle.net/city41/uQrza/1/" target="_blank" rel="noopener">fiddle</a></p>
<p>é€šè¿‡è¿™ä¸ªåŠæ³•ï¼Œè¿™æ®µä»£ç è¿˜æ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œè™½ç„¶æœ‰äº›å‹‰å¼ºã€‚</p>
<h3 id="å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½"><a href="#å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½" class="headerlink" title="å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½"></a>å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½</h3><p>ç›®å‰è¿™ä¸ªç®€é™‹çš„ promise å®ç°ç‰ˆæœ¬ï¼Œåªèƒ½åœ¨åŒæ­¥æ‰§è¡Œçš„ä»£ç ä¸­è¿è¡Œï¼ˆè¯‘æ³¨ï¼šåŸæ–‡ç”¨çš„è¯æ˜¯ asynchronicityï¼Œä¸ªäººè®¤ä¸ºæ˜¯å†™é”™äº†ï¼Œåº”è¯¥æ˜¯synchronicityï¼‰ã€‚åªè¦ <code>then()</code> ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ®µç¨‹åºå°±ä¼šå†æ¬¡å¤±è´¥ï¼Œ<code>callback</code> åˆä¼šå˜æˆ nullã€‚ä¸ºä»€ä¹ˆæˆ‘è¦åšè¿™ä¸ªé”™è¯¯çš„ç¤ºä¾‹å‘¢ï¼Œé‚£æ˜¯å› ä¸ºè¿™ä¸ªå®ç°ç‰ˆæœ¬çš„å¥½å¤„æ˜¯æµ…æ˜¾æ˜“æ‡‚ï¼Œè®©ä½ å…ˆäº†è§£ä¸ªå¤§æ¦‚ã€‚<code>then()</code> å’Œ <code>resolve()</code> ä¸‹æ¥ä¹Ÿä¼šç»§ç»­ä¿ç•™ç€ï¼Œå®ƒä»¬æ˜¯ promise çš„æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªä¾‹å­èƒ½è¡¨æ˜æˆ‘çš„æ„æ€ï¼š</p>
<p><a href="http://jsfiddle.net/3kku32vp/" target="_blank" rel="noopener">fiddle</a></p>
<p>*è¯‘æ³¨ï¼šSTARTğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = doSomething()</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    	log(<span class="string">"got a value"</span>, value);</span><br><span class="line">		&#125;);</span><br><span class="line">&#125;, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//setTimeout å»¶è¿Ÿ `then()` çš„è°ƒç”¨ï¼Œå› æ­¤ promise å…ˆæ‰§è¡Œï¼Œæ­¤æ—¶ promise çš„ callback è¿˜æ˜¯ null</span></span><br></pre></td></tr></table></figure></p>
<p>*è¯‘æ³¨ï¼šENDğŸ‘†</p>
<p>å¦‚æœä½ æ‰“å¼€ consoleï¼Œä½ ä¼šå‘ç°ä¸€ä¸ªé”™è¯¯æç¤ºï¼šcallback is not a function ã€‚å› ä¸º <code>then()</code> åœ¨ <code>setTimeout</code> é‡Œè°ƒç”¨.</p>
<h2 id="Promises-çš„çŠ¶æ€"><a href="#Promises-çš„çŠ¶æ€" class="headerlink" title="Promises çš„çŠ¶æ€"></a><a name="Promisesçš„çŠ¶æ€">Promises çš„çŠ¶æ€</a></h2><p>ä¸Šé¢é‚£ä¸ªä¸å¯é çš„å®ç°ç‰ˆæœ¬æé†’æˆ‘ä»¬ï¼ŒPromise åº”è¯¥æœ‰çŠ¶æ€æ ‡å¿—ã€‚æˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºæ‰§è¡Œå‰çŸ¥é“ï¼Œå½“å‰å¤„äºå“ªç§çŠ¶æ€ï¼Œå¹¶ä¿è¯çŠ¶æ€çš„æ­£ç¡®åœ°å˜æ›´ã€‚è¿™æ ·ç¨‹åºæ‰ä¼šå˜å¾—å¥å£®èµ·æ¥ã€‚</p>
<blockquote>
<ul>
<li>promise ç­‰å¾…ä¸€ä¸ªå€¼æ—¶ï¼Œå®ƒçš„çŠ¶æ€æ˜¯ pendingï¼Œè·å–ä¸€ä¸ªå€¼ä¹‹åï¼ŒçŠ¶æ€æ˜¯ resolved ã€‚</li>
<li>å½“ promise resolve ä¸€ä¸ªå€¼ï¼ˆvalueï¼‰ä¹‹åï¼Œå®ƒä¼šé”å®šé‚£ä¸ªå€¼ï¼Œä¸ä¼šå†æ¬¡ resolveã€‚</li>
</ul>
</blockquote>
<p>ï¼ˆpromise è¿˜éœ€è¦ä¸€ä¸ª rejected çš„çŠ¶æ€ï¼Œç”¨äºå¤„ç†å‘ç”Ÿé”™è¯¯çš„æƒ…å†µï¼Œæˆ‘ä»¬ç¨åå†æ¶‰åŠè¿™æ–¹é¢çš„å†…å®¹ï¼‰</p>
<p>è®©æˆ‘ä»¬åœ¨ promise é‡ŒåŠ å…¥çŠ¶æ€æ ‡å¿—ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æš‚è¡ŒåŠæ³•ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> state = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="keyword">var</span> value;</span><br><span class="line">  <span class="keyword">var</span> deferred;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">    value = newValue;</span><br><span class="line">    state = <span class="string">'resolved'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(deferred) &#123;</span><br><span class="line">      handle(deferred);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">onResolved</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      deferred = onResolved;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onResolved(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">onResolved</span>) </span>&#123;</span><br><span class="line">    handle(onResolved);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  fn(resolve);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://jsfiddle.net/city41/QX85J/1/" target="_blank" rel="noopener">fiddle</a></p>
<p>è™½ç„¶ä»£ç å˜å¾—æ¯”åŸæ¥å¤æ‚äº†ï¼Œä¸è¿‡ç°åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥è°ƒç”¨ <code>then()</code>ï¼Œ<code>resolve()</code> ä¹Ÿå¯ä»¥åœ¨éšæ—¶è¢«è°ƒç”¨ï¼Œä¸¤è€…ä¸å¿…è€ƒè™‘è°å…ˆè°åã€‚è¿™æ ·å°±å¯ä»¥åŒæ—¶æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥çš„ä»£ç ã€‚</p>
<p>è¿™éƒ½æ˜¯å› ä¸ºæœ‰äº† state è¿™ä¸ªæ ‡å¿—ï¼Œ<code>then()</code> å’Œ <code>resolve()</code> éƒ½æŠŠåŸæ¥çš„å·¥ä½œäº¤ç»™äº† <code>handle()</code>ã€‚<code>handle()</code> å°†æ ¹æ®ä¸åŒ state ä½œå‡ºä»¥ä¸‹å¤„ç†ï¼š</p>
<ul>
<li>å¦‚æœ <code>then()</code> å…ˆäº <code>resolve()</code> è¢«è°ƒç”¨ï¼Œå½“å‰è¿˜æ²¡æœ‰ value å¯ä»¥äº¤ä»˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒçŠ¶æ€å°†æ˜¯ pendingï¼Œå›è°ƒæ–¹æ³• <code>onResolved</code> å°†è¢«è¢«æš‚æ—¶ä¿å­˜åˆ° <code>deferred</code>ã€‚ç›´åˆ° <code>resolve()</code> è¢«è°ƒç”¨åï¼Œå†äº¤ä»˜ value å¹¶è§¦å‘å¯„å­˜åœ¨ <code>deferred</code> çš„ <code>onResolved</code>ã€‚</li>
<li>å¦‚æœ <code>resolve()</code> å…ˆäº <code>then()</code> è¢«è°ƒç”¨ï¼Œvalue ä¼šè¢«ä¿å­˜ä¸‹æ¥ï¼Œå½“ <code>then()</code> è¢«è°ƒç”¨æ—¶ï¼Œvalue å°±å¯ä»¥äº¤ä»˜äº†ã€‚</li>
</ul>
<p>æ³¨æ„åˆ°æ²¡æœ‰ï¼Œç°åœ¨å·²ç»ä¸éœ€è¦ç”¨åˆ° <code>setTimeout</code> äº†ï¼Œä¸è¿‡è¿™åªæ˜¯æš‚æ—¶çš„ï¼Œç­‰ä¼šå„¿è¿˜è¦å†ç”¨åˆ°ã€‚</p>
<blockquote>
</blockquote>
<p>åœ¨ promises é‡Œï¼Œå¹¶ä¸è®²ç©¶ç¨‹åºæ‰§è¡Œçš„å…ˆåæ¬¡åºï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å†³å®šå…ˆè°ƒç”¨ <code>then()</code> è¿˜æ˜¯ <code>resolve()</code>ã€‚è¿™ä¹Ÿæ˜¯â€œâ€æ•è·ä¸€ä¸ªç»ˆå€¼å¹¶ä¿å­˜åˆ°å¯¹è±¡é‡Œâ€çš„å¼ºå¤§ä¹‹å¤„ã€‚</p>
<blockquote>
</blockquote>
<p>æŒ‰ Promises/A+ è§„èŒƒï¼Œæˆ‘ä»¬çš„ promises è¿˜æœ‰ä¸å°‘è¦å®Œå–„çš„åœ°æ–¹ï¼Œä¸è¿‡å½“å‰å·²ç»æŒºå¼ºå¤§çš„äº†ã€‚æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨ <code>then()</code>ï¼Œæ¯æ¬¡éƒ½ä¼šå¾—åˆ°ç›¸åŒçš„è¿”å›å€¼ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = doSomething();</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Got a value:'</span>, value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Got the same value again:'</span>, value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<blockquote>
</blockquote>
<p>å½“ç„¶ï¼Œå¯¹äºç›®å‰çš„ promise å®ç°ç‰ˆæœ¬ï¼Œè¿™ç§è¯´æ³•ä¹Ÿä¸å®Œå…¨æ˜¯å¯¹çš„ã€‚å¯èƒ½ä¼šæœ‰ç›¸åçš„æƒ…å†µ: æ¯”å¦‚ï¼Œåœ¨ <code>resolve()</code> è°ƒç”¨ä¹‹å‰ï¼Œå¤šæ¬¡è°ƒç”¨ <code>then()</code>ï¼Œåªä¼šæˆåŠŸå…‘ç°æœ€åä¸€æ¬¡è°ƒç”¨çš„ <code>then()</code>ã€‚å¯¹äºè¿™ç§æƒ…å†µæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šæŠŠ promise é‡Œæ‰€æœ‰çš„ deferreds éƒ½ä¿å­˜åœ¨ä¸€ä¸ªåˆ—è¡¨é‡Œï¼Œè€Œä¸æ˜¯åƒç°åœ¨åªä¿å­˜åœ¨ä¸€ä¸ªå˜é‡é‡Œã€‚ä¸ºäº†ä¸è®©æœ¬æ–‡å˜å¾—æ›´å¤æ‚ï¼Œæˆ‘å°±ä¸åœ¨è¿™é‡Œå®ç°è¿™ä¸ªç‰¹æ€§ã€‚</p>
<blockquote>
</blockquote>
</blockquote>
<h2 id="å®ç°-Promisesé“¾"><a href="#å®ç°-Promisesé“¾" class="headerlink" title="å®ç° Promisesé“¾"></a><a name="å®ç°Promisesé“¾">å®ç° Promisesé“¾</a></h2><p>promise å¯ä»¥å¼‚æ­¥åœ°æ•è·ä¸€ä¸ªæ¦‚å¿µå¹¶ä¿å­˜åˆ°å¯¹è±¡é‡Œï¼ˆcapture the notion of asynchronicity in an object)ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥<br>å®ç° promise é“¾ï¼Œæ˜ å°„ promisesï¼Œè®©å®ƒä»¬ä¾åºæˆ–è€…å¹³è¡Œåœ°è¿è¡Œâ€¦â€¦ä»¥ä¸‹çš„ä»£ç åœ¨ promise ä¸­å¾ˆå¸¸è§ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getSomeData()</span><br><span class="line">.then(filterTheData)</span><br><span class="line">.then(processTheData)</span><br><span class="line">.then(displayTheData);</span><br></pre></td></tr></table></figure></p>
<p><code>getSomeData</code> è¿”å›ä¸€ä¸ª promiseï¼Œå¹¶è°ƒç”¨ <code>then()</code>ï¼Œè€Œç¬¬ä¸€ä¸ª then è¿”å›çš„ï¼Œä¹Ÿå¿…é¡»æ˜¯ä¸€ä¸ª promiseï¼Œç„¶åæ‰å¯ä»¥ä¸æ–­åœ°è°ƒç”¨ <code>then()</code>ã€‚</p>
<blockquote>
<p><code>then()</code> æ€»æ˜¯è¿”å›ä¸€ä¸ª promise</p>
</blockquote>
<p>å®ç°äº†é“¾çš„ promise ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> state = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="keyword">var</span> value;</span><br><span class="line">  <span class="keyword">var</span> deferred = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">    value = newValue;</span><br><span class="line">    state = <span class="string">'resolved'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(deferred) &#123;</span><br><span class="line">      handle(deferred);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      deferred = handler;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!handler.onResolved) &#123;</span><br><span class="line">      handler.resolve(value);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ret = handler.onResolved(value);</span><br><span class="line">    handler.resolve(ret);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">onResolved</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">      handle(&#123;</span><br><span class="line">        onResolved: onResolved,</span><br><span class="line">        resolve: resolve</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  fn(resolve);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://jsfiddle.net/city41/HdzLv/2/" target="_blank" rel="noopener">fiddle</a></p>
<p>å—¯ï¼Œä»£ç å¼€å§‹æœ‰ç‚¹å¤æ€ªäº†ï¼Œä½ åº”è¯¥åº†å¹¸æˆ‘ä»¬æ…¢æ…¢åœ°æ„å»ºè¿™ä¸€åˆ‡ã€‚è¿™ä¸ªç¯èŠ‚æœ€å…³é”®å°±æ˜¯ï¼Œ<code>then()</code> è¿”å›ä¸€ä¸ªæ–°çš„ promise ã€‚</p>
<blockquote>
<blockquote>
</blockquote>
<p>ç”±äº <code>then()</code> æ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promise å¯¹è±¡ï¼Œè¿™æ„å‘³ç€è‡³å°‘æœ‰ä¸€ä¸ª promise å¯¹è±¡è¢«åˆ›å»º(created)ã€å¤„ç†(resolved)ï¼Œæœ€ç»ˆå´è¢«æ— è§†(ignored)ã€‚è¿™ç§æƒ…å†µä¹Ÿè¢«è§†ä¸ºä¸€ç§æµªè´¹ï¼Œå›è°ƒæ¨¡å¼å°±ä¸å­˜åœ¨è¿™ç§é—®é¢˜ã€‚è¿™æ˜¯ promise çš„ä¸€ä¸ªå¼Šç«¯ï¼Œæƒ³å¿…ç°åœ¨ä½ ä¹Ÿèƒ½ç†è§£ä¸ºä»€ä¹ˆ Javascript åœˆå­é‡Œæœ‰äººä¼šä¸å–œæ¬¢ promiseã€‚</p>
<blockquote>
</blockquote>
</blockquote>
<p>é‚£ä¹ˆï¼Œç¬¬äºŒä¸ª promise çš„è¦ resolve çš„å€¼åœ¨å“ªé‡Œå‘¢ï¼Ÿå®ƒæ¥è‡ªç¬¬ä¸€ä¸ª promise çš„è¿”å›å€¼ï¼Œåœ¨ <code>handle()</code> æ–¹æ³•çš„æœ€åéƒ¨åˆ†å®ç°ã€‚ <code>handler</code> å¯¹è±¡åŒ…å«äº†ä¸€ä¸ª <code>onResolved</code> å›è°ƒæ–¹æ³•å’Œä¸€ä¸ª <code>resolve()</code> çš„å¼•ç”¨ï¼ˆreferenceï¼‰ã€‚å› ä¸ºæœ‰ä¸åªä¸€ä¸ª <code>resolve()</code> æ–¹æ³•ï¼Œæ¯ä¸ª promise éƒ½ä¼šå¤åˆ¶å±äºè‡ªèº«çš„ <code>resolve()</code> æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªè¿è¡Œè¯¥æ–¹æ³•çš„é—­åŒ…ã€‚è¿™ä¹Ÿæ˜¯ä»ç¬¬ä¸€ä¸ª promise è¿‡æ¸¡åˆ°ç¬¬äºŒä¸ª promise çš„æ¡¥æ¢ã€‚</p>
<p>æˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ª promise å½’ç»“åˆ°è¿™è¡Œä»£ç ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ret = handler.onResolved(value);</span><br></pre></td></tr></table></figure></p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>handler.onResolved</code> ç›¸å½“äºï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Got a value:"</span>, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¢å¥è¯è¯´ï¼Œå…ˆæœ‰ä¸€ä¸ª value è¢«ä¼ åˆ°ç¬¬ä¸€ä¸ª <code>then()</code>ï¼Œç„¶åç¬¬ä¸€ä¸ª <code>handler</code> çš„è¿”å›å€¼åˆ™ç”¨äº resolve ç¬¬äºŒä¸ª promise çš„å€¼ï¼Œè¿™æ ·å°±å®ç°äº† promise é“¾ ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'first result'</span>, result);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">88</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">secondResult</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'second result'</span>, secondResult);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// the output is</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// first result 42</span></span><br><span class="line"><span class="comment">// second result 88</span></span><br><span class="line"></span><br><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'first result'</span>, result);</span><br><span class="line">  <span class="comment">// not explicitly returning anything</span></span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">secondResult</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'second result'</span>, secondResult);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// now the output is</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// first result 42</span></span><br><span class="line"><span class="comment">// second result undefined</span></span><br></pre></td></tr></table></figure></p>
<p>å› ä¸º <code>then()</code> æ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ª promiseï¼Œæ‰€ä»¥è¿™ä¸ª promise é“¾å¯ä»¥æ— é™å»¶é•¿ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'first result'</span>, result);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">88</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">secondResult</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'second result'</span>, secondResult);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">99</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">thirdResult</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'third result'</span>, thirdResult);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">200</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">fourthResult</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// on and on...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å‡å¦‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦åœ¨æœ€åæ”¶é›†æ•´ä¸ª promise é“¾çš„æ¯ä¸€ä¸ªè¿”å›å€¼ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿåˆ©ç”¨è¿™æ®µ promise é“¾ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ„å»ºè¿”å›çš„ç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(function(result) &#123;</span><br><span class="line">  var results = [result];</span><br><span class="line">  results.push(88);</span><br><span class="line">  return results;</span><br><span class="line">&#125;).then(function(results) &#123;</span><br><span class="line">  results.push(99);</span><br><span class="line">  return results;</span><br><span class="line">&#125;).then(function(results) &#123;</span><br><span class="line">  console.log(results.join(&apos;,&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">// the output is</span><br><span class="line">//</span><br><span class="line">// 42, 88, 99</span><br></pre></td></tr></table></figure></p>
<blockquote>
</blockquote>
<p>Promises åªä¼š resolve ä¸€ä¸ªå€¼ value ã€‚å¦‚æœä½ éœ€è¦ä¼ é€’è¶…è¿‡ä¸€ä¸ªå€¼ï¼Œå°±éœ€è¦æŠŠå¤šä¸ªå€¼æ”¹å¤´æ¢é¢åŒ…è£…èµ·æ¥ï¼ˆæ¯”å¦‚ç”¨æ•°ç»„ã€å¯¹è±¡ï¼Œåˆå¹¶å­—ç¬¦ä¸²ï¼Œç­‰ç­‰ï¼‰ã€‚</p>
<blockquote>
</blockquote>
<p>æ›´å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨ promise çš„ <code>all()</code> æ–¹æ³•ï¼Œæˆ–è€…å…¶å®ƒçš„å·¥å…·æ–¹æ³•ï¼Œå®ƒä»¬æ‹“å±•äº† promise çš„å¯ç”¨æ€§ï¼Œä¸‹æ¥ä¹Ÿå°†ä¼šæ¢è®¨è¿™éƒ¨åˆ†å†…å®¹ã€‚</p>
<h3 id="å›è°ƒæ˜¯å¯é€‰é¡¹"><a href="#å›è°ƒæ˜¯å¯é€‰é¡¹" class="headerlink" title="å›è°ƒæ˜¯å¯é€‰é¡¹"></a>å›è°ƒæ˜¯å¯é€‰é¡¹</h3><p><code>then()</code> æ–¹æ³•é‡Œçš„å›è°ƒå¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä½ çœç•¥å®ƒï¼Œéšåçš„ promise ä¼šæ¥ç€ resolve ä¸Šä¸€ä¸ª promise è¿”å›çš„å€¼ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'got a result'</span>, result);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// the output is</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// got a result 42</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸ªä¸­åŸå› å¯ä»¥åœ¨ <code>handle()</code>é‡Œå‘ç°ï¼Œå‡å¦‚æ²¡æœ‰å›è°ƒï¼Œå®ƒå°±ä¼š resolve ä¸Šä¸€ä¸ª promise ç•™ä¸‹çš„å€¼ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!handler.onResolved) &#123;</span><br><span class="line">  handler.resolve(value);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="åœ¨-Promise-é“¾é‡Œè¿”å›-Promise-ç±»å‹"><a href="#åœ¨-Promise-é“¾é‡Œè¿”å›-Promise-ç±»å‹" class="headerlink" title="åœ¨ Promise é“¾é‡Œè¿”å› Promise ç±»å‹"></a><a name="åœ¨Promiseé“¾ä¸­è¿”å›Promise">åœ¨ Promise é“¾é‡Œè¿”å› Promise ç±»å‹</a></h3><p>å½“å‰çš„ promise é“¾è¿˜æ˜¯æœ‰äº›åˆçº§ï¼Œå®ƒåªä¼šæœºæ¢°åœ°æŠŠ resolve ä¹‹åçš„å€¼ä¼ é€’ä¸‹å»ã€‚å‡å¦‚å…¶ä¸­ä¸€ä¸ªè¢« resolve çš„å€¼æ˜¯ promise â€”â€”å°±åƒä¸‹é¢è¿™æ®µä»£ç â€”â€”ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// doSomethingElse returns a promise</span></span><br><span class="line">  <span class="keyword">return</span> doSomethingElse(result);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">finalResult</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"the final result is"</span>, finalResult);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>å¦‚ä»£ç æ‰§è¡Œçš„ç»“æœæ‰€ç¤ºï¼Œ<code>finalResult</code> ä¸æ˜¯ä¸€ä¸ª resolve ä¹‹åçš„å€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ª promiseï¼Œå¦‚æœè¦å¾—åˆ°é¢„æœŸçš„ç»“æ„ï¼Œéœ€è¦è¿™æ ·ä¿®æ”¹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// doSomethingElse returns a promise</span></span><br><span class="line">  <span class="keyword">return</span> doSomethingElse(result);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">anotherPromise</span>) </span>&#123;</span><br><span class="line">  anotherPromise.then(<span class="function"><span class="keyword">function</span>(<span class="params">finalResult</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"the final result is"</span>, finalResult);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä½†è°ä¼šå¸Œæœ›ä»£ç è¿™æ ·ä¹±ç³Ÿç³Ÿçš„ï¼Ÿå†æ”¹è¿›ä¸€ä¸‹å®ç° promise çš„ä»£ç ï¼Œå°±å¯ä»¥ä¼˜é›…åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚<br>åœ¨ <code>resolve()</code> æ–¹æ³•é‡Œå¢åŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œå¤„ç† promise çš„æƒ…å†µï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(newValue &amp;&amp; <span class="keyword">typeof</span> newValue.then === <span class="string">'function'</span>) &#123;</span><br><span class="line">    newValue.then(resolve);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  state = <span class="string">'resolved'</span>;</span><br><span class="line">  value = newValue;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(deferred) &#123;</span><br><span class="line">    handle(deferred);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://jsfiddle.net/city41/38CCb/2/" target="_blank" rel="noopener">fiddle</a></p>
<p>å¦‚æœæˆ‘ä»¬å¾—åˆ°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª promiseï¼Œå°±ä¼šå¾ªç¯åœ°è°ƒç”¨ <code>resolve()</code>ã€‚å½“è¿”å›å€¼ä¸æ˜¯ promise æ—¶ï¼Œå°±åƒä¹‹å‰é‚£æ ·æ‰§è¡Œã€‚</p>
<blockquote>
<blockquote>
<p>è¿™é‡Œä¹Ÿæœ‰å¯èƒ½ä¼šå‡ºç°æ— é™å¾ªç¯çš„æƒ…å†µï¼ŒPromises/A+ è§„èŒƒå»ºè®®å®ç° promise æ—¶è¦æ£€æµ‹æ— é™å¾ªç¯çš„æƒ…å†µï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ã€‚</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
</blockquote>
<p>è¿˜æœ‰éœ€è¦æŒ‡å‡ºçš„ä¸€ç‚¹ï¼Œè¿™é‡Œä¸Šè¿°åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä¸º promise çš„æ–¹æ³•å¹¶ä¸ç¬¦åˆ Promises/A+ è§„èŒƒï¼Œè¿™ç¯‡æ–‡ç« çš„å†…å®¹ä¹Ÿæ²¡æœ‰å®Œå…¨ç¬¦åˆ Promises/A+ è§„èŒƒã€‚å¦‚æœä½ å¯¹è¿™æ–¹é¢çš„å†…å®¹æ„Ÿåˆ°å¥½å¥‡ï¼Œå»ºè®®ä½ é˜…è¯»è¿™ä¸€èŠ‚ <a href="https://promisesaplus.com/#the-promise-resolution-procedure" target="_blank" rel="noopener">promise resolution procedure</a>.</p>
<blockquote>
</blockquote>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åˆ¤æ–­ <code>newValue</code> æ˜¯å¦ä¸º promise çš„æ–¹æ³•æ˜¯å¾ˆå®½æ¾çš„ï¼Œåªåˆ¤æ–­è¿”å›å€¼æ˜¯å¦æœ‰ä¸€ä¸ª <code>then()</code> æ–¹æ³•ã€‚æˆ‘è¿™ç§ <a href="https://en.wikipedia.org/wiki/Duck_typing" target="_blank" rel="noopener">duck typing</a> çš„åšæ³•å…¶å®æ˜¯æ•…æ„çš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸åŒçš„ promise å®ç°ç‰ˆæœ¬å°±å¯ä»¥ååŒä½¿ç”¨ï¼ˆinteroptï¼‰ã€‚å®é™…ä¸Šï¼Œä¸åŒ promise åº“ä¹‹å‰æ··ç”¨æ˜¯å¾ˆå¸¸è§çš„ï¼Œä½ åœ¨ä½¿ç”¨ä¸åŒçš„ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½ä½¿ç”¨ä¸åŒçš„ promise å®ç°æ–¹æ³•ã€‚</p>
<blockquote>
<p>ä¸åŒçš„ promise å®ç°æ–¹æ³•å¯ä»¥ååŒä½¿ç”¨ï¼ˆinteroptï¼‰ï¼Œåªè¦å®ƒä»¬éƒ½æ°å¦‚å…¶åˆ†åœ°éµç…§ Promises/A+ è§„èŒƒ</p>
</blockquote>
<p>å®ç°äº† promise é“¾ä¹‹åï¼Œå½“å‰çš„ç‰ˆæœ¬å·²ç»ç›¸å¯¹æ¯”è¾ƒå®Œå–„äº†ï¼Œä½†è¿˜ç¼ºå°‘é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p>
<h2 id="Promises-çš„-Reject"><a href="#Promises-çš„-Reject" class="headerlink" title="Promises çš„ Reject"></a><a name="Promisesçš„Reject">Promises çš„ Reject</a></h2><p>å½“ promise æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æ—¶ï¼Œéœ€è¦æœ‰ä¸€ä¸ªåŸå› æ¥ reject ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>then()</code> é‡Œä¼ å…¥ç¬¬äºŒä¸ªå›è°ƒæ–¹æ³•å¤„ç†è¿™ä¸€è¿‡ç¨‹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">doSomething().then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Success!'</span>, value);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Uh oh'</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å¦‚å…ˆå‰æ‰€è¿°ï¼Œpromise çš„çŠ¶æ€å°†ä» pending è½¬å˜åˆ° resolved æˆ– rejected ä¹‹ä¸€ã€‚å› æ­¤ï¼Œ<code>then()</code> çš„ä¸¤ä¸ªå›è°ƒæ–¹æ³•åªæœ‰ä¸€ä¸ªä¼šè¢«è°ƒç”¨ã€‚</p>
</blockquote>
<p>Promises é€šè¿‡ <code>reject()</code> æ–¹æ³•æ¥å®ç°æ‹’ç»ï¼Œä»¥ä¸‹æ˜¯å®ç°äº†é”™è¯¯å¤„ç†çš„ <code>doSomething()</code> ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = somehowGetTheValue();</span><br><span class="line">    <span class="keyword">if</span>(result.error) &#123;</span><br><span class="line">      reject(result.error);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(result.value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ promise çš„å®ç°æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åŠ å…¥ reject ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> state = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="keyword">var</span> value;</span><br><span class="line">  <span class="keyword">var</span> deferred = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(newValue &amp;&amp; <span class="keyword">typeof</span> newValue.then === <span class="string">'function'</span>) &#123;</span><br><span class="line">      newValue.then(resolve, reject);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    state = <span class="string">'resolved'</span>;</span><br><span class="line">    value = newValue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(deferred) &#123;</span><br><span class="line">      handle(deferred);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    state = <span class="string">'rejected'</span>;</span><br><span class="line">    value = reason;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(deferred) &#123;</span><br><span class="line">      handle(deferred);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      deferred = handler;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> handlerCallback;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(state === <span class="string">'resolved'</span>) &#123;</span><br><span class="line">      handlerCallback = handler.onResolved;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      handlerCallback = handler.onRejected;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!handlerCallback) &#123;</span><br><span class="line">      <span class="keyword">if</span>(state === <span class="string">'resolved'</span>) &#123;</span><br><span class="line">        handler.resolve(value);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        handler.reject(value);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ret = handlerCallback(value);</span><br><span class="line">    handler.resolve(ret);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span>(<span class="params">onResolved, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      handle(&#123;</span><br><span class="line">        onResolved: onResolved,</span><br><span class="line">        onRejected: onRejected,</span><br><span class="line">        resolve: resolve,</span><br><span class="line">        reject: reject</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  fn(resolve, reject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://jsfiddle.net/city41/rLXsL/2/" target="_blank" rel="noopener">fiddle</a></p>
<p>é™¤äº†å¢åŠ äº† <code>reject()</code> æ–¹æ³•ï¼Œ<code>handle()</code> æ–¹æ³•ä¹Ÿè¦å¯¹ rejection ä½œå‡ºå¤„ç†ã€‚åœ¨ <code>handle()</code> æ–¹æ³•é‡Œï¼Œå°†æ ¹æ® <code>state</code> çš„çŠ¶æ€åˆ†åˆ«ä½œå‡º reject æˆ– resolve ã€‚è€Œå½“å‰çš„ <code>state</code> çš„ä¹Ÿä¼šè¢«ä¼ é€’åˆ°ä¸‹ä¸€ä¸ª promise ï¼Œä¸‹ä¸€ä¸ª promise çš„ <code>resolve()</code> æˆ– <code>reject()</code> æ–¹æ³•åŒæ ·ä¹Ÿä¼šæ”¹å˜å®ƒè‡ªèº«çš„ <code>state</code>ã€‚</p>
<blockquote>
<blockquote>
</blockquote>
<p>ä½¿ç”¨ promise æ—¶ï¼Œå¾ˆå®¹æ˜“å¿½ç•¥å¤„ç†é”™è¯¯çš„å›è°ƒï¼Œè¿™æ ·ä½ å°±ä¸ä¼šå¾—åˆ°é”™è¯¯æç¤ºã€‚è‡³å°‘ä½ åº”è¯¥åœ¨ä½ çš„æœ€åä¸€ä¸ª promise é‡ŒåŠ ä¸Šé”™è¯¯å›è°ƒã€‚å…³äºè¿™ä¸ªé—®é¢˜ä½ å¯ä»¥æŸ¥çœ‹ä¸‹æ–‡â€œ promiseå¯èƒ½ä¼šâ€˜åƒæ‰â€™é”™è¯¯â€ä¸€èŠ‚çš„å†…å®¹</p>
<blockquote>
</blockquote>
</blockquote>
<h3 id="æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ°-Reject"><a href="#æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ°-Reject" class="headerlink" title="æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ° Reject"></a><a name="æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ°Reject">æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ° Reject</a></h3><p>ç›®å‰ï¼Œæˆ‘ä»¬çš„é”™è¯¯å¤„ç†åªé’ˆå¯¹å·²çŸ¥é”™è¯¯ã€‚å¯èƒ½æœ‰æœªçŸ¥çš„å¼‚å¸¸å‡ºç°ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ‰€ä»¥æœ‰å¿…è¦åœ¨å®ç° promise æ—¶å¯¹æ„å¤–ä½œå‡ºæ­£ç¡®çš„ rejectï¼Œå³åœ¨ <code>resolve()</code> æ–¹æ³•é‡ŒåŠ å…¥ <code>try/catch</code> ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ... as before</span></span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    reject(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ­¤å¤–ï¼Œè¿˜å¾—ç¡®ä¿ä¼ å…¥ <code>handle()</code> å›è°ƒæ–¹æ³•ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... as before</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ret;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    ret = handlerCallback(value);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    handler.reject(e);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handler.resolve(ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Promises-å¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯"><a href="#Promises-å¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯" class="headerlink" title="Promises å¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯"></a><a name="Promiseså¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯">Promises å¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯</a></h3><blockquote>
<blockquote>
<p>promise ä¹Ÿæœ‰å¯èƒ½å› ä¸ºè¯¯è§£ï¼Œå¯¼è‡´é”™è¯¯è¢«åƒæ‰ï¼Œå¾ˆå¤šäººå°±è¢«è¿™ç§æƒ…å†µå‘è¿‡ã€‚</p>
</blockquote>
</blockquote>
<p>è¯·çœ‹ä»¥ä¸‹ä¾‹å­ï¼š<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSomeJson</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> badJson = <span class="string">"&lt;div&gt;uh oh, this is not JSON at all!&lt;/div&gt;"</span>;</span><br><span class="line">    resolve(badJson);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getSomeJson().then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(json);</span><br><span class="line">  <span class="built_in">console</span>.log(obj);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'uh oh'</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><a href="http://jsfiddle.net/city41/M7SRM/3/" target="_blank" rel="noopener">fiddle</a></p>
<p>è¿™æ®µä»£ç å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<code>then()</code> æ–¹æ³•é‡Œçš„å›è°ƒæœŸæœ›å¾—åˆ°çš„æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œå°±å¤©çœŸåœ°æŠŠç»“æœå½“ä½œ JSON æ¥è§£æï¼Œå¯¼è‡´å‘ç”Ÿå¼‚å¸¸ã€‚è™½ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†å¤„ç†é”™è¯¯çš„å›è°ƒï¼Œä½†ç®¡ç”¨å—ï¼Ÿ</p>
<blockquote>
<blockquote>
</blockquote>
<p>å®é™…ä¸Šï¼Œé”™è¯¯å›è°ƒå¹¶æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå¦‚æœä½ åœ¨ fiddle ä¸Šè¿è¡Œè¿™æ®µä»£ç ï¼Œä½ ä¸ä¼šå¾—åˆ°ä»»ä½•è¾“å‡ºï¼Œæ²¡æœ‰é”™è¯¯ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚</p>
<blockquote>
</blockquote>
</blockquote>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿå› ä¸ºæœªå¤„ç†çš„å¼‚å¸¸å‘ç”Ÿåœ¨ <code>then()</code> çš„å›è°ƒæ–¹æ³•é‡Œï¼Œå®ƒæ˜¯åœ¨ <code>handle()</code> æ–¹æ³•é‡Œè¢«æ•è·çš„ã€‚è¿™å¯¼è‡´ <code>hande()</code> æ–¹æ³• reject äº† <code>then()</code> è¿”å›çš„ promiseï¼Œè€Œä¸æ˜¯æ­£åœ¨å¤„ç†çš„ promiseï¼Œæ•´ä¸ªè¿‡ç¨‹å°±åƒ promise è¢«æ­£ç¡®çš„ resolve ä¸€æ ·ã€‚</p>
<blockquote>
</blockquote>
<p>è®°ä½ï¼Œåœ¨ <code>then()</code> çš„å›è°ƒé‡Œï¼Œä½ æ­£åœ¨å“åº”çš„ promise å·²ç»è¢« resolveï¼Œæ‰€ä»¥ä½ çš„å›è°ƒæ–¹æ³•å¯¹è¿™ä¸ª promise æ²¡æœ‰å½±å“</p>
<blockquote>
</blockquote>
<p>å¦‚æœä½ æƒ³æ•è·ä¸Šé¢çš„é‚£ä¸ªé”™è¯¯ï¼Œéœ€è¦åœ¨ä¸‹æ¸¸åŠ ä¸€ä¸ªé”™è¯¯å¤„ç†ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getSomeJson().then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(json);</span><br><span class="line">  <span class="built_in">console</span>.log(obj);</span><br><span class="line">&#125;).then(<span class="literal">null</span>, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"an error occured: "</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±å¯ä»¥æ‰“å°å¤„é”™è¯¯æ—¥å¿—äº†ã€‚</p>
<blockquote>
<blockquote>
<p>æŒ‰æˆ‘çš„ä¸ªäººç»éªŒï¼Œè¿™æ˜¯ promise æœ€å¤§çš„ç¼ºé™·ã€‚ä¸‹ä¸€èŠ‚ä»‹ç»äº†ä¸€ä¸ªæ›´å¥½çš„åŠæ³•â€”â€”<code>done()</code>â€”â€”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote>
</blockquote>
<h3 id="ä½¿ç”¨-done-æ¥æŒ½æ•‘"><a href="#ä½¿ç”¨-done-æ¥æŒ½æ•‘" class="headerlink" title="ä½¿ç”¨ done() æ¥æŒ½æ•‘"></a><a name="ä½¿ç”¨doneæ¥æŒ½æ•‘">ä½¿ç”¨ <code>done()</code> æ¥æŒ½æ•‘</a></h3><p>å¤§éƒ¨åˆ†ï¼ˆå¹¶éæ‰€æœ‰ï¼‰promise åº“éƒ½æœ‰ä¸€ä¸ª <code>done()</code> æ–¹æ³•ã€‚å®ƒå’Œ <code>then()</code> å¾ˆåƒï¼Œå¹¶ä¸”æ²¡æœ‰ä¸Šé¢æåˆ°çš„ç¼ºé™·ã€‚</p>
<p>ä»»ä½•å¯ä»¥ä½¿ç”¨ <code>then()</code> çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ <code>done()</code>ï¼Œå®ƒçš„ä¸»è¦ä¸åŒç‚¹åœ¨äºä¸ä¼šè¿”å›ä¸€ä¸ª promiseï¼Œè€Œä¸”ä»»ä½•å‘ç”Ÿåœ¨ <code>done()</code> å‘ç”Ÿçš„å¼‚å¸¸ï¼Œä¸ä¼šè¢« promise çš„å®ç°æœºåˆ¶æ•è·ã€‚æ¢å¥è¯è¯´ï¼Œ<code>done()</code> è¡¨ç¤ºæ•´ä¸ª promise é“¾éƒ½è¢« resolve äº†ã€‚ä¸Šé¢ <code>getSomeJson()</code> å¦‚æœä½¿ç”¨ <code>done()</code> ä¼šæ›´åŠ å¥å£®:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getSomeJson().done(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// when this throws, it won't be swallowed</span></span><br><span class="line">  <span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(json);</span><br><span class="line">  <span class="built_in">console</span>.log(obj);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><code>done()</code> ä¹Ÿå¯ä»¥å¢åŠ ä¸€ä¸ªå¤„ç†é”™è¯¯çš„å›è°ƒâ€”â€”<code>done(callback, errback)</code>ï¼Œå› ä¸ºæ‰€æœ‰çš„ promise éƒ½è¢« resovle äº†ï¼Œæ‰€ä»¥å¦‚æœæœ‰å¼‚å¸¸å‘ç”Ÿï¼Œä½ ä¹Ÿä¼šå¾—åˆ°é€šçŸ¥ã€‚</p>
<blockquote>
<blockquote>
<p><code>done()</code> ä¸å±äº Promises/A+ è§„èŒƒï¼ˆè‡³å°‘ç°åœ¨ä¸æ˜¯ï¼‰ï¼Œæ‰€ä»¥ä½ ä½¿ç”¨çš„ promise åº“å¯èƒ½æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ã€‚</p>
</blockquote>
</blockquote>
<h3 id="ä»-Reject-ä¸­æŒ½æ•‘å›æ¥"><a href="#ä»-Reject-ä¸­æŒ½æ•‘å›æ¥" class="headerlink" title="ä» Reject ä¸­æŒ½æ•‘å›æ¥"></a><a name="ä»Rejectä¸­æŒ½æ•‘å›æ¥">ä» Reject ä¸­æŒ½æ•‘å›æ¥</a></h3><p>æŠŠä¸€ä¸ªè¢« reject çš„ promise æŒ½æ•‘å›æ¥æ˜¯æœ‰å¯èƒ½çš„ã€‚å¦‚æœ <code>then()</code> çš„é”™è¯¯å›è°ƒè¢«è°ƒç”¨äº†ï¼Œä¹‹åçš„ promise å°±ä¼šä»¥ resolve æ¥å“åº”ï¼Œè€Œä¸æ˜¯ reject ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">aMethodThatRejects().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// won't get here</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// since aMethodThatRejects calls reject()</span></span><br><span class="line">  <span class="comment">// we end up here in the errback</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"recovered!"</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"after recovery: "</span>, result);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// we won't actually get here</span></span><br><span class="line">  <span class="comment">// since the rejected promise had an errback</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// the output is</span></span><br><span class="line"><span class="comment">// after recovery: recovered!</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœ <code>then()</code> æ²¡æœ‰ä¼ å…¥å¤„ç†é”™è¯¯çš„å›è°ƒï¼Œreject å°±ä¼šè¢«ä¼ é€’åˆ°ä¸‹ä¸€ä¸ª promise ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// notice the two calls to then()</span></span><br><span class="line">aMethodThatRejects().then().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// we won't get here</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"error propagated"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// the output is</span></span><br><span class="line"><span class="comment">// error propagated</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Promise-å¿…é¡»æ˜¯å¼‚æ­¥çš„"><a href="#Promise-å¿…é¡»æ˜¯å¼‚æ­¥çš„" class="headerlink" title="Promise å¿…é¡»æ˜¯å¼‚æ­¥çš„"></a><a name="Promiseå¿…é¡»æ˜¯å¼‚æ­¥çš„">Promise å¿…é¡»æ˜¯å¼‚æ­¥çš„</a></h2><p>æœ¬æ–‡å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨åˆ° <code>setTimeout</code>ï¼Œä½†å¾ˆå¿«åˆç§»é™¤äº†ã€‚<br>æŒ‰ Promises/A+ è§„èŒƒï¼Œpromise å¿…é¡»æ˜¯å¼‚æ­¥çš„ã€‚è¦ç¬¦åˆè¿™ä¸ªè¦æ±‚ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬åªè¦æŠŠ <code>handle()</code> çš„ä¸»è¦ä»£ç å°è£…åœ¨ <code>setTimeout</code> é‡Œé¢ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">    deferred = handler;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ... as before</span></span><br><span class="line">  &#125;, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®é™…ä¸Šï¼ŒçœŸæ­£çš„ promise åº“å¹¶ä¸å€¾å‘ä½¿ç”¨ <code>setTimeout</code>ã€‚å¦‚æœæ˜¯é¢å‘ NodeJS çš„åº“ï¼Œå®ƒå€¾å‘ä½¿ç”¨ <code>process.nextTick</code>ï¼Œå¦‚æœæ˜¯é’ˆå¯¹æµè§ˆå™¨çš„ï¼Œå¯èƒ½ç”¨ <code>setImmediate</code> æˆ–è€… <a href="https://github.com/NobleJS/setImmediate" target="_blank" rel="noopener">setImmediate shim</a> (ç›®å‰åªæœ‰ IE æ”¯æŒ setImmediate)ï¼Œåˆæˆ–è€…æ˜¯ Kris Kowal çš„å¼‚æ­¥å·¥å…·åº“ <a href="https://github.com/kriskowal/asap" target="_blank" rel="noopener">asap</a>ï¼ˆKris Kowal è¿˜å†™äº† <a href="https://github.com/kriskowal/q" target="_blank" rel="noopener">Q</a> ï¼Œä¸€ä¸ªå¾ˆå—æ¬¢è¿çš„ promise åº“ï¼‰</p>
<h3 id="ä¸ºä»€ä¹ˆ-Promises-A-è§„èŒƒè¦æ±‚å¼‚æ­¥ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Promises-A-è§„èŒƒè¦æ±‚å¼‚æ­¥ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Promises/A+ è§„èŒƒè¦æ±‚å¼‚æ­¥ï¼Ÿ"></a><a name="ä¸ºä»€ä¹ˆPromises/A+è§„èŒƒè¦æ±‚å¼‚æ­¥">ä¸ºä»€ä¹ˆ Promises/A+ è§„èŒƒè¦æ±‚å¼‚æ­¥ï¼Ÿ</a></h3><p>å› ä¸ºè¿™æ ·å¯ä»¥ä¿è¯ä»£ç åœ¨æ‰§è¡Œè¿‡ç¨‹ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”æ›´åŠ å¯é ï¼Œè¯·çœ‹ä¸‹é¢ä¾‹å­ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = doAnOperation();</span><br><span class="line">invokeSomething();</span><br><span class="line">promise.then(wrapItAllUp);</span><br><span class="line">invokeSomethingElse();</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ®µä»£ç ç¨‹åºè°ƒç”¨çš„æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿä»å­—é¢ç†è§£ï¼Œä½ å¯èƒ½è®¤ä¸ºæ˜¯ <code>invokeSomething()</code> -&gt; <code>invokeSomethingElse()</code> -&gt; <code>wrapItAllUp()</code>ã€‚å®é™…ä¸Šå´æ˜¯å–å†³äº promise çš„ resolve æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„ã€‚å¦‚æœ <code>doAnOperation()</code> æ˜¯å¼‚æ­¥çš„ï¼Œæµç¨‹å’Œé¢„æƒ³çš„ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå¦‚æœ <code>doAnOperation()</code> æ˜¯åŒæ­¥çš„ï¼Œæµç¨‹å°±ä¼šå˜æˆï¼š<code>invokeSomething()</code> -&gt; <code>wrapItAllUp()</code> -&gt; <code>invokeSomethingElse()</code>ï¼Œè¿™æ ·å°±ä¸å¥½äº†ã€‚</p>
<p>ä¸ºäº†é¿å¼€è¿™ç§æƒ…å†µï¼Œpromise å¿…é¡»å¼‚æ­¥åœ° resolveï¼Œå³ä½¿æ˜¯ä½ å¹¶ä¸éœ€è¦ã€‚è¿™æ ·ä¼šå‡å°‘æ„å¤–å‘ç”Ÿï¼Œåˆ«äººåœ¨ä½¿ç”¨ promise çš„æ—¶å€™ä¹Ÿä¸ç”¨è€ƒè™‘åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ã€‚</p>
<blockquote>
<blockquote>
</blockquote>
<p>Promises always require at least one more iteration of the event loop to resolve. This is not necessarily true of the standard callback approach.</p>
<blockquote>
</blockquote>
</blockquote>
<h2 id="å‡†å¤‡å°è£…-then-promise-ä¹‹å‰"><a href="#å‡†å¤‡å°è£…-then-promise-ä¹‹å‰" class="headerlink" title="å‡†å¤‡å°è£… then/promise ä¹‹å‰"></a><a name="å‡†å¤‡å°è£…then/promiseä¹‹å‰">å‡†å¤‡å°è£… then/promise ä¹‹å‰</a></h2><p>ç›®å‰å¸‚é¢ä¸Šå·²ç»æœ‰è®¸å¤šç‰¹æ€§é½å…¨çš„ promise åº“ã€‚<a href="https://github.com/then" target="_blank" rel="noopener">then</a> ç»„ç»‡çš„ promise åº“æ˜¯æœ€ç®€å•çš„ã€‚å®ƒçš„ç›®çš„å°±æ˜¯ï¼Œä»¥æœ€ç®€çœçš„æ–¹æ³•å®ç°ä¸€ä¸ªç¬¦åˆ Promises/A+ è§„èŒƒçš„ promise åº“ï¼Œå¦‚æœä½ çœ‹çœ‹å®ƒçš„å®ç°æ–¹æ³•ï¼Œä¼šå‘ç°çœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿã€‚</p>
<blockquote>
<blockquote>
<p>æœ¬æ–‡å®Œæˆæ—¶ï¼Œæœ€ç»ˆçš„ promise ç‰ˆæœ¬çœ‹èµ·æ¥å°±å¾ˆåƒ then/promise çš„ç‰ˆæœ¬ã€‚ä»¥åå¯èƒ½å°±ä¸åƒäº†ï¼Œå› ä¸ºå®ƒä»¬æ­£æ¨åˆ°é‡å†™ promise å®ç°æ–¹æ³•ã€‚</p>
</blockquote>
</blockquote>
<p>æœ¬æ–‡çš„ promise ç‰ˆæœ¬å’Œå®é™…çš„ promise åº“æœ‰äº›ä¸åŒï¼Œå› ä¸ºæœ‰è®¸å¤š Promises/A+ è§„èŒƒé‡Œçš„ç»†èŠ‚æˆ‘å¹¶æ²¡æœ‰æ¶‰åŠã€‚æˆ‘å»ºè®®é˜…è¯» Promises/A+ è§„èŒƒï¼Œå®ƒå¾ˆç®€çŸ­ï¼Œè€Œä¸”é€šä¿—ç›´ç™½ã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å¦‚æœä½ çœ‹åˆ°è¿™ï¼ŒçœŸè¦è°¢è°¢ä½ èŠ±æ—¶é—´çš„è¯»ä¸‹æ¥äº†ã€‚æˆ‘ä»¬å·²ç»è§¦åŠåˆ° promises çš„æ ¸å¿ƒï¼Œè¿™ä¹Ÿæ˜¯Promises/A+ è§„èŒƒå”¯ä¸€æåŠçš„å†…å®¹ã€‚å¤§éƒ¨åˆ†çš„ promise å®ç°æ–¹æ³•ä¼šæä¾›æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚ <code>all()</code>, <code>spread()</code>, <code>race()</code>, <code>denodeify()</code> ç­‰å¾…ã€‚æˆ‘å»ºè®®é˜…è¯» [API docs for Bluebird] äº†è§£æ›´å¤šå…³äº promise çš„å†…å®¹ã€‚</p>
<p>å½“æˆ‘ç†è§£äº† promise çš„å·¥ä½œåŸç†å’Œæ³¨æ„äº‹é¡¹åï¼Œæˆ‘æ›´å–œæ¬¢å®ƒäº†ï¼Œå®ƒè®©æˆ‘çš„ä»£ç å˜å¾—æ›´åŠ æ•´æ´ã€ä¼˜é›…ã€‚å®ƒè¿˜æœ‰è®¸å¤šå¯ä»¥è°ˆè®ºçš„è¯é¢˜ï¼Œæœ¬æ–‡åªæ˜¯æŠ›ç –å¼•ç‰ã€‚</p>
<h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><p>æ›´å¤šå…³äº promises çš„æ–‡ç«   </p>
<ul>
<li><a href="promisejs.org">promisejs.org</a> â€“ great tutorial on promises (already mentioned it a few times)</li>
<li><a href="Qâ€™s Design Rationale">Qâ€™s Design Rationale</a> â€“ an article much like this one, but goes into even more detail. By Kris Kowal, creator of Q</li>
<li><a href="https://github.com/domenic/promises-unwrapping/issues/19" target="_blank" rel="noopener">Some debate over whether done() is a good thing</a></li>
<li><a href="http://solutionoptimist.com/2013/12/27/javascript-promise-chains-2/" target="_blank" rel="noopener">Flattening Promise Chains</a> by Thomas Burleson. A nice article that goes into more advanced usage of promises. If my article is the â€œwhatâ€, then Thomasâ€™s is a nice look at the â€œwhyâ€.</li>
</ul>
<p><strong>Found a mistake?</strong> if I made an error and you want to let me know, please <a href="matt.e.greer@gmail.com">email me</a> or <a href="https://github.com/city41/blog/issues" target="_blank" rel="noopener">file an issue</a>. Thanks!</p>
<h2 id="ç¿»è¯‘"><a href="#ç¿»è¯‘" class="headerlink" title="ç¿»è¯‘"></a>ç¿»è¯‘</h2><ul>
<li><a href="http://p-baleine.hatenablog.com/entry/2014/03/12/190000" target="_blank" rel="noopener">æ—¥æ–‡ç¿»è¯‘</a>, translated by Junpei Tajima</li>
<li><a href="http://p-baleine.hatenablog.com/entry/2014/03/12/190000" target="_blank" rel="noopener">ç¹ä½“ä¸­æ–‡ç¿»è¯‘</a>, translated by Jih-Chi Lee</li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/12/2017-09-26-gitolite-installation-and-setup-on-ubuntu-16-04-lts/" rel="next" title="åœ¨ ubuntu æ­å»ºåŸºäº Gitolite çš„ Git æœåŠ¡å™¨">
                <i class="fa fa-chevron-left"></i> åœ¨ ubuntu æ­å»ºåŸºäº Gitolite çš„ Git æœåŠ¡å™¨
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/12/2017-09-28-how-to-build-private-repo-server-for-android-source-code/" rel="prev" title="æ­å»ºæ”¯æŒ Repo çš„ Android æºç é•œåƒï¼ˆRepo æœåŠ¡å™¨ï¼‰">
                æ­å»ºæ”¯æŒ Repo çš„ Android æºç é•œåƒï¼ˆRepo æœåŠ¡å™¨ï¼‰ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ttimehc</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ›´æ–°æ—¥å¿—"><span class="nav-number">1.</span> <span class="nav-text">æ›´æ–°æ—¥å¿—</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç›®å½•"><span class="nav-number">2.</span> <span class="nav-text">ç›®å½•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ºä»€ä¹ˆ"><span class="nav-number">3.</span> <span class="nav-text">ä¸ºä»€ä¹ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ€ç®€å•çš„ä¾‹å­"><span class="nav-number">4.</span> <span class="nav-text">æœ€ç®€å•çš„ä¾‹å­</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®šä¹‰-Promise-ç±»å‹"><span class="nav-number">4.1.</span> <span class="nav-text">å®šä¹‰ Promise ç±»å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½"><span class="nav-number">4.2.</span> <span class="nav-text">å½“å‰çš„ä»£ç æ—¢è„†å¼±åˆä¸å¥½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Promises-çš„çŠ¶æ€"><span class="nav-number">5.</span> <span class="nav-text">Promises çš„çŠ¶æ€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ç°-Promisesé“¾"><span class="nav-number">6.</span> <span class="nav-text">å®ç° Promisesé“¾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å›è°ƒæ˜¯å¯é€‰é¡¹"><span class="nav-number">6.1.</span> <span class="nav-text">å›è°ƒæ˜¯å¯é€‰é¡¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨-Promise-é“¾é‡Œè¿”å›-Promise-ç±»å‹"><span class="nav-number">6.2.</span> <span class="nav-text">åœ¨ Promise é“¾é‡Œè¿”å› Promise ç±»å‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Promises-çš„-Reject"><span class="nav-number">7.</span> <span class="nav-text">Promises çš„ Reject</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ°-Reject"><span class="nav-number">7.1.</span> <span class="nav-text">æœªçŸ¥é”™è¯¯åº”è¯¥å½’çº³åˆ° Reject</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Promises-å¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯"><span class="nav-number">7.2.</span> <span class="nav-text">Promises å¯èƒ½ä¼šâ€œåƒæ‰â€é”™è¯¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨-done-æ¥æŒ½æ•‘"><span class="nav-number">7.3.</span> <span class="nav-text">ä½¿ç”¨ done() æ¥æŒ½æ•‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä»-Reject-ä¸­æŒ½æ•‘å›æ¥"><span class="nav-number">7.4.</span> <span class="nav-text">ä» Reject ä¸­æŒ½æ•‘å›æ¥</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Promise-å¿…é¡»æ˜¯å¼‚æ­¥çš„"><span class="nav-number">8.</span> <span class="nav-text">Promise å¿…é¡»æ˜¯å¼‚æ­¥çš„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸ºä»€ä¹ˆ-Promises-A-è§„èŒƒè¦æ±‚å¼‚æ­¥ï¼Ÿ"><span class="nav-number">8.1.</span> <span class="nav-text">ä¸ºä»€ä¹ˆ Promises/A+ è§„èŒƒè¦æ±‚å¼‚æ­¥ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡†å¤‡å°è£…-then-promise-ä¹‹å‰"><span class="nav-number">9.</span> <span class="nav-text">å‡†å¤‡å°è£… then/promise ä¹‹å‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç»“è®º"><span class="nav-number">10.</span> <span class="nav-text">ç»“è®º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å»¶ä¼¸é˜…è¯»"><span class="nav-number">11.</span> <span class="nav-text">å»¶ä¼¸é˜…è¯»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç¿»è¯‘"><span class="nav-number">12.</span> <span class="nav-text">ç¿»è¯‘</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ttimehc</span>

  

  
</div>


  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>



  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  


  
    <!-- LOCAL: You can save these files to your site and update links -->

  
  <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitmint.browser.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css">
<!-- END LOCAL -->

<script>
  function renderGitment() {
    var gitment = new Gitmint({
      id: window.location.pathname,
      owner: 'chasecs',
      repo: 'chasecs.github.io',
      
        lang: '' || navigator.language || navigator.systemLanguage || navigator.userLanguage,
      
      oauth: {
      
      
        client_secret: '054b7811c14e27f869e637afd14f6f380fa632c1',
      
        client_id: 'eb2224abc6c383a0371e'
      }
    });
    gitment.render('gitment-container');
  }

  
    renderGitment();
  
</script>

  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
